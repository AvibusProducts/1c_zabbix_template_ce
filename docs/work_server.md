# Рабочий сервер

Для мониторинга роли **Рабочего сервера** реализован сбор следующих показателей:
* Количество процессов ragent;
* Суммарный объем памяти всех процессов ragent;
* Количество исключений (событий EXCP) возникших в процессах ragent;
* Количество процессов rmngr;
* Суммарный объем памяти всех процессов rmngr;
* Количество исключений (событий EXCP) возникших в процессах rmngr;
* Количество процессов rphost;
* Суммарный объем памяти всех процессов rphost;
* Количество исключений (событий EXCP) возникших в процессах rphost;
* Изменение в списке рабочих процессов;
* Режим отладки сервера;
* Количество событий об управляемых блокировках - TLOCK (по-умолчанию деактивирован);
* Количество таймаутов на управляемых блокировках (по-умолчанию деактивирован);
* Количество взаимоблокировок на управляемых блокировках (по-умолчанию деактивирован);
* Суммарное время ожидания на управляемых блокировках (по-умолчанию деактивирован);
* ТОП серверных вызовов по суммарной длительности (по-умолчанию деактивирован);
* ТОП серверных вызовов по суммарному процессорному времени (по-умолчанию деактивирован);
* ТОП серверных вызовов по суммарному вводу-выводу (по-умолчанию деактивирован);
* ТОП серверных вызовов по средней длительности (по-умолчанию деактивирован);
* ТОП серверных вызовов по суммарному количеству (по-умолчанию деактивирован);
* ТОП серверных вызовов по максимальной памяти за вызов (по-умолчанию деактивирован);
* ТОП "ленивых" (с большой длительностью и малым процессорным временем) серверных вызовов (по-умолчанию деактивирован);
* Объем оперативной памяти сервера.

## Макросы для рабочего сервера
В шаблоне рабочего сервера есть следующие макросы:
* **{$LOG_DIR}** - каталог для хранения файлов технологического журнала;
* **{$MAX_LOCK_WAIT}** - пороговое значение суммарного времени ожидания на управляемых блокировках за прошедший час, по превышении которого срабатывает триггер, указанное в секундах;
* **{$TOP_LIST_SIZE}** - количество выдаваемых (сохраняемых) записей в агригированных выборках по серверным вызовам;
* **{$RAS_PORTS}** - порт(ы) сервера RAS, для кластера(ов), в котором(ых) данный сервер является центральным (в случае несколькихх значений, они указываются через запятую);
* **{$RAS_TIMEOUT}** - максимальное время ожидание ответа сервиса RAS, указанное в секундах;
* **{$RAS_USER}** - имя пользователя (администратора кластера), необходимое для получения данных от сервиса RAS;
* **{$RAS_PASS}** - пароль пользователя (администратора кластера);
* **{$RPHOST_MAX_MEM}** - пороговое значение суммарного объема памяти, занимаемого процессами rphost, по превышении которого срабатывает триггер;
* **{$EXCP_THRESHOLD}** - пороговое количество исключений на один процесс, по превышении которого срабатывает триггер.

## Триггеры
Для отслеживания критичных изменений показателей роли **Рабочего сервера** созданы триггеры, срабатывающие при следующих событиях:
* Отсутствуют процессы ragent. Уровень важности - **Высокая**;
* Отсутствуют процессы rmngr. Уровень важности - **Высокая**;
* Отсутствуют процессы rphost. Уровень важности - **Высокая**;
* В списке процессов rphost происходят частые измеенния. Уровень важности - **Высокая**;
* Превышено пороговое значение объема памяти, занимаемого процессами rphost (регулируется макросом {$RPHOST_MAX_MEM}). Уровень важности - **Средняя**;
* Обнаружены таймауты на управляемых блокировках 1С. Уровень важности - **Высокая**;
* Обнаружены взаимоблокировки на управляемых блокировках 1С. Уровень важности - **Высокая**;
* Превышено пороговое значение ожидания на управляемых блокировках 1С, регулируемое макросом {$MAX_LOCK_WAIT}. Уровень важности - **Высокая**;
* Включен режим отладки. Уровень важности - **Средняя**;
* Количество исключений по процессам ragent превышает {$EXCP_THRESHOLD}. Уровень важности - **Средняя**;
* Количество исключений по процессам rmngr превышает {$EXCP_THRESHOLD}. Уровень важности - **Средняя**;
* Количество исключений по процессам rphost превышает {$EXCP_THRESHOLD}. Уровень важности - **Средняя**;
* Отсутствуют события TLOCK. Уровень важности - **Информация**.

## Графики
Для визуализации показателей роли **Рабочего сервера** предусмотрены следущие графики:
* Количество ошибок по процессам ragent, rmngr и rphost;
* Объем используемой памяти процессами сервера 1С Предприятия в разрезе ragent, rmngr и rphost.

[Назад](../README.md)
